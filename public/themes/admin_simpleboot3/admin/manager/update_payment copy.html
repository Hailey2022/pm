<include file="public@header" />
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合同</title>
    <script type="text/html" id="files-item-tpl">
        <li id="saved-file{id}">
            <input class="form-control" id="file-{id}" type="hidden" name="file_urls[]" value="{filepath}">
            <input class="form-control" id="file-{id}-name" type="text" name="file_names[]" value="{name}"
                   style="width: 600px;" title="文件名称">
            <a class="btn" id="file-{id}-preview" href="{preview_url}" target="_blank" download="{name}">下载</a>
            <a class="btn" href="javascript:uploadOne('文件上传','#file-{id}','file');">替换</a>
            <a class="btn" href="javascript:(function(){$('#saved-file{id}').remove();})();">移除</a>
        </li>
    </script>
    <script type="text/html" id="files-item-tpl1">
        <li id="saved-file1-{id}">
            <input class="form-control" id="file1-{id}" type="hidden" name="file1_urls[]" value="{filepath}">
            <input class="form-control" id="file1-{id}-name" type="text" name="file1_names[]" value="{name}"
                   style="width: 600px;" title="文件名称">
            <a class="btn" id="file1-{id}-preview" href="{preview_url}" target="_blank" download="{name}">下载</a>
            <a class="btn" href="javascript:uploadOne('文件上传','#file1-{id}','file');">替换</a>
            <a class="btn" href="javascript:(function(){$('#saved-file1-{id}').remove();})();">移除</a>
        </li>
    </script>
</head>
<body>
    <form method="post" class="form-horizontal js-ajax-form margin-top-20" action="{:url('manager/postPaymentUpdate')}">
        <div class="form-group">
            <label for="input-contractName" class="col-sm-2 control-label">实施单位名称</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" type="text" disabled value={$data.user_login}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-contractName" class="col-sm-2 control-label">合同名称</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" type="text" disabled value={$data.contractName}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-installment" class="col-sm-2 control-label">进度款（期数）</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-installment" name="installment" type="text"
                    value={$data.installment}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-ccp" class="col-sm-2 control-label">合计</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-sum" type="number" readonly>
            </div>
        </div>
        <div class="form-group">
            <label for="input-ccp" class="col-sm-2 control-label">中央</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-ccp" name="ccp" type="number" required value={$data.ccp}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-province" class="col-sm-2 control-label">省</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-province" name="province" type="number" required
                    value={$data.province}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-city" class="col-sm-2 control-label">市</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-city" name="city" type="number" required value={$data.city}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-bond" class="col-sm-2 control-label">专项债(区)</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-bond" name="bond" type="number" required value={$data.bond}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-budget" class="col-sm-2 control-label">预算(区)</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-budget" name="budget" type="number" required value={$data.budget}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-others" class="col-sm-2 control-label">其他</label>
            <div class="col-md-6 col-sm-10">
                <input class="form-control" id="input-others" name="others" type="number" required value={$data.others}>
            </div>
        </div>
        <div class="form-group">
            <label for="input-comment" class="col-sm-2 control-label">备注</label>
            <div class="col-md-6 col-sm-10">
                <textarea class="form-control" id="input-comment" name="comment" type="text"
                    value={$data.comment}>{$data.comment}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label for="input-contractNumber" class="col-sm-2 control-label">支付凭证附件</label>
            <div class="col-md-6 col-sm-10">
                <tr>
                    <td>
                        <ul id="files" class="pic-list list-unstyled form-inline">
                            <notempty name="files">
                                <foreach name="files" key="url" item="name">
                                    <php>$file_url=cmf_get_file_download_url($url);</php>
                                    <php>$file_id=hash("sha256", uniqid() . $url);</php>
                                    <li id="saved-file{$file_id}">
                                        <input class="form-control" id="file-{$file_id}" type="hidden"
                                            name="file_urls[]" value="{$url}">
                                        <input class="form-control" id="file-{$file_id}-name" type="text"
                                            name="file_names[]" value="{$name}" style="width: 600px;" title="文件名称">
                                        <a class="btn" id="file-{$file_id}-preview" href="{$file_url}" target="_blank"
                                            download="{$name}">下载</a>
                                        <a class="btn"
                                            href="javascript:uploadOne('文件上传','#file-{$file_id}','file');">替换</a>
                                        <a class="btn"
                                            href="javascript:(function(){$('#saved-file{$file_id}').remove();})();">移除</a>
                                    </li>
                                </foreach>
                            </notempty>
                        </ul>
                        <a href="javascript:uploadMultiFile('支付凭证附件上传','#files','files-item-tpl','file');"
                            class="btn btn-default">选择文件</a>
                    </td>
                </tr>
            </div>
        </div>
        <div class="form-group">
            <label for="input-contractNumber" class="col-sm-2 control-label">支金来源凭证附件</label>
            <div class="col-md-6 col-sm-10">
                <tr>
                    <td>
                        <ul id="files1" class="pic-list list-unstyled form-inline">
                            <notempty name="files1">
                                <foreach name="files1" key="url" item="name">
                                    <php>$file_url=cmf_get_file_download_url($url);</php>
                                    <php>$file_id=hash("sha256", uniqid() . $url);</php>
                                    <li id="saved-file1-{$file_id}">
                                        <input class="form-control" id="file1-{$file_id}" type="hidden"
                                            name="file1_urls[]" value="{$url}">
                                        <input class="form-control" id="file1-{$file_id}-name" type="text"
                                            name="file1_names[]" value="{$name}" style="width: 600px;" title="文件名称">
                                        <a class="btn" id="file1-{$file_id}-preview" href="{$file_url}" target="_blank"
                                            download="{$name}">下载</a>
                                        <a class="btn"
                                            href="javascript:uploadOne('文件上传','#file1-{$file_id}','file');">替换</a>
                                        <a class="btn"
                                            href="javascript:(function(){$('#saved-file1-{$file_id}').remove();})();">移除</a>
                                    </li>
                                </foreach>
                            </notempty>
                        </ul>
                        <a href="javascript:uploadMultiFile('支金来源凭证附件上传','#files1','files-item-tpl1','file');"
                            class="btn btn-default">选择文件</a>
                    </td>
                </tr>
            </div>
        </div>
        <div class="form-group">
            <input name="paymentId" hidden value={$data.paymentId}>
        </div>
        <div class="form-group">
            <input name="contractId" hidden value={$data.contractId}>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-primary js-ajax-submit">更新</button>
                <a class="btn btn-default adminuse" href="javascript:history.go(-1)">返回</a>
            </div>
        </div>
    </form>
</html>
<script type="text/javascript" src="__STATIC__/js/admin.js"></script>
<script type="text/javascript" src="__STATIC__/js/frontend.js"></script>
<script>
    function sum() {
        list = ['ccp', 'province', 'city', 'bond', 'budget', 'others'];
        var s = 0;
        for (var i = 0; i < list.length; i++) {
            s += Number($("#input-" + list[i]).val())
        }
        $("#input-sum").val(s)
    }
    (function () {
        sum()
        $(".form-group").on('keyup', function () {
            sum()
        })
    })()
</script>